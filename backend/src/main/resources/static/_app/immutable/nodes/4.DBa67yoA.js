import{c as ye,l as we,a as g,b as i,f as _,g as re,t as U,d as ie}from"../chunks/P4ebssvT.js";import{p as Te,Q as Ye,w as Ge,l as ce,b as d,r as u,m as t,C as le,j as r,d as xe,R as Je,F as f,T as Ke,z as Me,A as We,t as C,h as L,U as Xe,i as B,e as Ze,k as S,f as s,u as ge,s as v,q as _e,n as O}from"../chunks/B96m4iMf.js";import{l as Se,p as et,b as tt,i as N,w as y}from"../chunks/zfKQsIjr.js";import{i as Ie}from"../chunks/BviUTUxV.js";import{n as he,l as be,d as $e,I as se,B as ee,L as at,R as Ce,a as ot,T as rt}from"../chunks/C3EW5A4L.js";import{M as Be}from"../chunks/DyB4Bkd-.js";import{D as st}from"../chunks/DaJ0c-eI.js";import{a as Ee,S as nt,C as qe,s as Ae}from"../chunks/DcMN-269.js";ve[f]="node_modules/carbon-components-svelte/src/DataTable/Toolbar.svelte";var it=g(_("<section><!></section>"),ve[f],[[32,0]]);function ve(Y,n){ye(new.target);const o=Se(n,["children","$$slots","$$events","$$legacy"]),w=Se(o,["size"]);Te(n,!1,ve);let b=et(n,"size",8,"default"),c=le(null);const p=Ge(!1);Ye("Toolbar",{overflowVisible:p,setOverflowVisible:G=>{p.set(G),t(c)&&Je(c,t(c).style.overflow=G?"visible":"inherit")}});var te={...we()};Ie();var D=it();Ee(D,()=>({"aria-label":"data table toolbar",...w,[qe]:{"bx--table-toolbar":!0,"bx--table-toolbar--small":ce(b(),"sm"),"bx--table-toolbar--normal":ce(b(),"default")},[nt]:{"z-index":1}}));var ue=d(D);return Ae(ue,n,"default",{},null),u(D),tt(D,G=>r(c,G),()=>t(c)),i(Y,D),xe(te)}de[f]="node_modules/carbon-components-svelte/src/DataTable/ToolbarContent.svelte";var lt=g(_("<div><!></div>"),de[f],[[18,0]]);function de(Y,n){ye(new.target),Te(n,!1,de);const o=le(),w=le(),b=Ke("DataTable")??{};let c=le([]);b?.batchSelectedIds&&b.batchSelectedIds.subscribe(D=>{r(c,D)}),Me(()=>t(c),()=>{r(o,t(c).length>0)}),Me(()=>t(o),()=>{r(w,t(o)?{inert:!0}:{})}),We();var p={...we()};Ie();var k=lt();Ee(k,()=>({...t(w),[qe]:{"bx--toolbar-content":!0}}));var te=d(k);return Ae(te,n,"default",{},null),u(k),i(Y,k),xe(p)}class ct{#e=C(L(Xe([])),"NotificationStore.notifications");get notifications(){return t(this.#e)}set notifications(n){r(this.#e,n,!0)}#t=C(L(!1),"NotificationStore.loading");get loading(){return t(this.#t)}set loading(n){r(this.#t,n,!0)}#a=C(L(null),"NotificationStore.error");get error(){return t(this.#a)}set error(n){r(this.#a,n,!0)}async loadNotifications(){this.loading=!0,this.error=null;try{const n=(await B(he.list()))();this.notifications=n.notifications}catch(n){this.error=n instanceof Error?n.message:"加载通知列表失败",console.error(...be("error","Failed to load notifications:",n))}finally{this.loading=!1}}async processNotification(n){this.loading=!0,this.error=null;try{(await B(he.process(n)))(),(await B(this.loadNotifications()))()}catch(o){throw this.error=o instanceof Error?o.message:"处理通知失败",console.error(...be("error","Failed to process notification:",o)),o}finally{this.loading=!1}}async deleteNotification(n){this.loading=!0,this.error=null;try{(await B(he.delete(n)))(),(await B(this.loadNotifications()))()}catch(o){throw this.error=o instanceof Error?o.message:"删除通知失败",console.error(...be("error","Failed to delete notification:",o)),o}finally{this.loading=!1}}clearError(){this.error=null}}const vt=new ct,z=vt;e[f]="src/routes/notifications/+page.svelte";var dt=g(_('<div class="loading-container svelte-1ce0uvz"><!></div>'),e[f],[[132,2]]),ut=g(_("<!> <!>",1),e[f],[]),ft=g(_('<div class="empty-state svelte-1ce0uvz"><!> <!></div>'),e[f],[[144,2]]),pt=g(_('<div class="action-buttons svelte-1ce0uvz"><!> <!></div>'),e[f],[[163,6]]),mt=g(_('<div class="notifications-container svelte-1ce0uvz"><!></div>'),e[f],[[153,2]]),gt=g(_('<div class="detail-row svelte-1ce0uvz"><span class="label svelte-1ce0uvz">ICCID:</span> <span class="value svelte-1ce0uvz"> </span></div>'),e[f],[[227,4,[[228,5],[229,5]]]]),_t=g(_('<p>确定要处理此通知吗？</p> <div class="notification-details svelte-1ce0uvz"><div class="detail-row svelte-1ce0uvz"><span class="label svelte-1ce0uvz">序列号:</span> <span class="value svelte-1ce0uvz"> </span></div> <div class="detail-row svelte-1ce0uvz"><span class="label svelte-1ce0uvz">操作类型:</span> <span class="value svelte-1ce0uvz"> </span></div> <div class="detail-row svelte-1ce0uvz"><span class="label svelte-1ce0uvz">通知地址:</span> <span class="value svelte-1ce0uvz"> </span></div> <!></div> <p class="info-text svelte-1ce0uvz">处理通知将向 SM-DP+ 服务器发送确认消息。</p>',1),e[f],[[210,2],[211,2,[[212,3,[[213,4],[214,4]]],[216,3,[[217,4],[218,4]]],[222,3,[[223,4],[224,4]]]]],[233,2]]),ht=g(_("<!> <!>",1),e[f],[]),bt=g(_('<p>确定要删除此通知吗？</p> <p class="warning-text svelte-1ce0uvz">删除通知不会向服务器发送任何消息，只是从本地移除记录。</p>',1),e[f],[[258,2],[259,2]]),$t=g(_("<!> <!>",1),e[f],[]),yt=g(_('<div class="notifications-page svelte-1ce0uvz"><div class="header svelte-1ce0uvz"><div><h1 class="svelte-1ce0uvz">通知管理</h1> <p class="svelte-1ce0uvz">查看和处理来自 SM-DP+ 服务器的通知</p></div></div> <!></div> <!> <!>',1),e[f],[[113,0,[[114,1,[[115,2,[[116,3],[117,3]]]]]]]]);function e(Y,n){ye(new.target),Te(n,!0,e);let o=C(L(null),"selectedNotification"),w=C(L(!1),"showProcessModal"),b=C(L(!1),"showDeleteModal"),c=C(L(!1),"isOperating"),p=C(L(null),"operationError");Ze(async()=>{$e.selectedDevice||(await B($e.loadDevices()))(),(await B(z.loadNotifications()))()});function k(){z.loadNotifications()}function te(a){r(o,a,!0),r(w,!0)}function D(a){r(o,a,!0),r(b,!0)}async function ue(){if(t(o)){r(c,!0),r(p,null);try{(await B(z.processNotification(t(o).seqNumber)))(),r(w,!1),r(o,null)}catch(a){r(p,a instanceof Error?a.message:"处理失败",!0)}finally{r(c,!1)}}}async function G(){if(t(o)){r(c,!0),r(p,null);try{(await B(z.deleteNotification(t(o).seqNumber)))(),r(b,!1),r(o,null)}catch(a){r(p,a instanceof Error?a.message:"删除失败",!0)}finally{r(c,!1)}}}function Ne(a){return{install:"安装",enable:"启用",disable:"禁用",delete:"删除"}[a]||a}const Oe=[{key:"seqNumber",value:"序列号",empty:!1},{key:"profileManagementOperation",value:"操作类型",empty:!1},{key:"notificationAddress",value:"通知地址",empty:!1},{key:"iccid",value:"ICCID",empty:!1},{key:"actions",value:"操作",empty:!1}];let Le=C(ge(()=>z.notifications.map(a=>({id:a.seqNumber.toString(),seqNumber:a.seqNumber,profileManagementOperation:Ne(a.profileManagementOperation),notificationAddress:a.notificationAddress,iccid:a.iccid||"N/A",notification:a}))),"rows");var Fe={...we()},ze=yt(),fe=S(ze),Re=v(d(fe),2);{var Ve=a=>{s(()=>se(a,{kind:"warning",title:"未选择设备",subtitle:"请先返回首页选择一个读卡器设备",$$slots:{actions:(F,I)=>{s(()=>ee(F,{href:"/",kind:"tertiary",children:y(e,(P,J)=>{O();var h=U("返回首页");i(P,h)}),$$slots:{default:!0}}),"component",e,128,4,{componentTag:"Button"})}}}),"component",e,122,2,{componentTag:"InlineNotification"})},He=a=>{var F=ie(),I=S(F);{var P=h=>{var T=dt(),l=d(T);s(()=>at(l,{description:"正在加载通知..."}),"component",e,133,3,{componentTag:"Loading"}),u(T),i(h,T)},J=h=>{var T=ie(),l=S(T);{var K=x=>{var E=ut(),W=S(E);s(()=>se(W,{kind:"error",title:"加载失败",get subtitle(){return z.error},$$events:{close:()=>z.clearError()}}),"component",e,136,2,{componentTag:"InlineNotification"});var R=v(W,2);s(()=>ee(R,{$$events:{click:k},children:y(e,(X,M)=>{O();var m=U("重试");i(X,m)}),$$slots:{default:!0}}),"component",e,142,2,{componentTag:"Button"}),i(x,E)},ne=x=>{var E=ie(),W=S(E);{var R=M=>{var m=ft(),V=d(m);s(()=>se(V,{kind:"info",title:"暂无通知",subtitle:"当前没有待处理的通知。通知通常由运营商发送，用于确认配置文件的安装、启用、禁用或删除操作。"}),"component",e,145,3,{componentTag:"InlineNotification"});var H=v(V,2);s(()=>ee(H,{get icon(){return Ce},$$events:{click:k},children:y(e,(j,Q)=>{O();var $=U("刷新");i(j,$)}),$$slots:{default:!0}}),"component",e,150,3,{componentTag:"Button"}),u(m),i(M,m)},X=M=>{var m=mt(),V=d(m);s(()=>st(V,{get headers(){return Oe},get rows(){return t(Le)},children:y(e,(H,j)=>{s(()=>ve(H,{children:y(e,(Q,$)=>{s(()=>de(Q,{children:y(e,(q,ae)=>{s(()=>ee(q,{get icon(){return Ce},$$events:{click:k},children:y(e,(oe,De)=>{O();var A=U("刷新");i(oe,A)}),$$slots:{default:!0}}),"component",e,157,6,{componentTag:"Button"})}),$$slots:{default:!0}}),"component",e,156,5,{componentTag:"ToolbarContent"})}),$$slots:{default:!0}}),"component",e,155,4,{componentTag:"Toolbar"})}),$$slots:{default:!0,cell:(H,j)=>{const Q=ge(()=>j.row),$=ge(()=>j.cell);var q=ie(),ae=S(q);{var oe=A=>{var Z=pt(),Pe=d(Z);s(()=>ee(Pe,{size:"small",kind:"tertiary",get icon(){return ot},$$events:{click:()=>te(t(Q).notification)},children:y(e,(pe,Ue)=>{O();var me=U("处理");i(pe,me)}),$$slots:{default:!0}}),"component",e,164,7,{componentTag:"Button"});var Qe=v(Pe,2);s(()=>ee(Qe,{size:"small",kind:"danger-tertiary",get icon(){return rt},$$events:{click:()=>D(t(Q).notification)},children:y(e,(pe,Ue)=>{O();var me=U("删除");i(pe,me)}),$$slots:{default:!0}}),"component",e,172,7,{componentTag:"Button"}),u(Z),i(A,Z)},De=A=>{var Z=U();_e(()=>re(Z,t($).value)),i(A,Z)};s(()=>N(ae,A=>{ce(t($).key,"actions")?A(oe):A(De,!1)}),"if",e,162,5)}i(H,q)}}}),"component",e,154,3,{componentTag:"DataTable"}),u(m),i(M,m)};s(()=>N(W,M=>{ce(z.notifications.length,0)?M(R):M(X,!1)},!0),"if",e,143,1)}i(x,E)};s(()=>N(l,x=>{z.error?x(K):x(ne,!1)},!0),"if",e,135,1)}i(h,T)};s(()=>N(I,h=>{z.loading?h(P):h(J,!1)},!0),"if",e,131,1)}i(a,F)};s(()=>N(Re,a=>{$e.selectedDevice?a(He,!1):a(Ve)}),"if",e,121,1)}u(fe);var ke=v(fe,2);s(()=>Be(ke,{modalHeading:"处理通知",primaryButtonText:"处理",secondaryButtonText:"取消",get primaryButtonDisabled(){return t(c)},get open(){return t(w)},set open(a){r(w,a,!0)},$$events:{"click:button--secondary":()=>r(w,!1),submit:ue},children:y(e,(a,F)=>{var I=ht(),P=S(I);{var J=l=>{s(()=>se(l,{kind:"error",title:"操作失败",get subtitle(){return t(p)},$$events:{close:()=>r(p,null)}}),"component",e,201,2,{componentTag:"InlineNotification"})};s(()=>N(P,l=>{t(p)&&l(J)}),"if",e,200,1)}var h=v(P,2);{var T=l=>{var K=_t(),ne=v(S(K),2),x=d(ne),E=v(d(x),2),W=d(E,!0);u(E),u(x);var R=v(x,2),X=v(d(R),2),M=d(X,!0);u(X),u(R);var m=v(R,2),V=v(d(m),2),H=d(V,!0);u(V),u(m);var j=v(m,2);{var Q=$=>{var q=gt(),ae=v(d(q),2),oe=d(ae,!0);u(ae),u(q),_e(()=>re(oe,t(o).iccid)),i($,q)};s(()=>N(j,$=>{t(o).iccid&&$(Q)}),"if",e,226,3)}u(ne),O(2),_e($=>{re(W,t(o).seqNumber),re(M,$),re(H,t(o).notificationAddress)},[()=>Ne(t(o).profileManagementOperation)]),i(l,K)};s(()=>N(h,l=>{t(o)&&l(T)}),"if",e,209,1)}i(a,I)}),$$slots:{default:!0}}),"component",e,191,0,{componentTag:"Modal"});var je=v(ke,2);return s(()=>Be(je,{danger:!0,modalHeading:"删除通知",primaryButtonText:"删除",secondaryButtonText:"取消",get primaryButtonDisabled(){return t(c)},get open(){return t(b)},set open(a){r(b,a,!0)},$$events:{"click:button--secondary":()=>r(b,!1),submit:G},children:y(e,(a,F)=>{var I=$t(),P=S(I);{var J=l=>{s(()=>se(l,{kind:"error",title:"操作失败",get subtitle(){return t(p)},$$events:{close:()=>r(p,null)}}),"component",e,249,2,{componentTag:"InlineNotification"})};s(()=>N(P,l=>{t(p)&&l(J)}),"if",e,248,1)}var h=v(P,2);{var T=l=>{var K=bt();O(2),i(l,K)};s(()=>N(h,l=>{t(o)&&l(T)}),"if",e,257,1)}i(a,I)}),$$slots:{default:!0}}),"component",e,238,0,{componentTag:"Modal"}),i(Y,ze),xe(Fe)}export{e as component};
